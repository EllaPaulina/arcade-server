var l=Object.defineProperty;var h=(a,e,t)=>e in a?l(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>(h(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();class u{constructor(e){n(this,"selection",{x:0,y:0});n(this,"carts");n(this,"page",0);n(this,"numpages",1);n(this,"data");n(this,"cartsPerPage",12);n(this,"gameloading",!1);this.page=0,this.data=e,this.cartsPerPage=12,this.numpages=Math.ceil(this.data.length/this.cartsPerPage),this.carts=document.querySelector("game-grid"),this.carts.addEventListener("animationend",()=>this.carts.classList.remove("leftAnimation","rightAnimation")),this.generateGamePage(0),document.addEventListener("pagingSelected",t=>{let s=t.detail,i=s>this.page?1:-1;s==0&&this.page==this.numpages-1&&(i=1),s==this.numpages-1&&this.page==0&&(i=-1),this.page=s,this.generateGamePage(i)}),this.carts.classList.add("leftAnimation")}generateGamePage(e){this.page<0&&(this.page=this.numpages-1),this.page>=this.numpages&&(this.page=0),this.page=Math.min(Math.max(this.page,0),this.numpages-1),this.carts.innerHTML="";let t=this.page*this.cartsPerPage,s=Math.min(this.data.length-t,this.cartsPerPage);for(let i=t;i<t+s;i++)this.generateCoverImage(this.data[i]);e<0?this.carts.classList.add("leftAnimation"):e>0&&this.carts.classList.add("rightAnimation"),document.dispatchEvent(new CustomEvent("gamePageSelected",{detail:this.page}))}selectPosition(e){this.selection.x+=e,this.selection.y=r.instance.selectedRow,this.selection.x<0&&(this.page--,this.generateGamePage(-1),this.selection=this.getLastCartPosition(),r.instance.selectedRow=this.selection.y),this.selection.x>3&&(this.page++,this.generateGamePage(1),this.selection.x=0,this.selection.y=0,r.instance.selectedRow=0)}getLastCartPosition(){let t=(this.page+1)*this.cartsPerPage>=this.data.length?this.data.length%this.cartsPerPage:this.cartsPerPage,s=Math.floor((t-1)/4);return{x:(t-1)%4,y:s}}updateCursor(){this.selection.y=r.instance.selectedRow;let e=this.getSelectedElement();e&&e.classList.add("cursor")}clearCursor(){let e=this.getSelectedElement();e&&e.classList.remove("cursor")}getSelectedElement(){let e=this.selection.x+this.selection.y*4;return this.carts.children[e]}buttonPressed(){if(this.gameloading)return;let e=this.getSelectedElement();e&&e.classList.add("chosengame"),e.addEventListener("animationend",()=>{let t=this.selection.x+this.selection.y*4+this.page*this.cartsPerPage;window.location.href=this.data[t].url}),this.gameloading=!0}generateCoverImage(e){let t=document.createElement("div");this.carts.append(t);let s=e.cover;s&&s!=""?(t.style.backgroundImage=`url(./covers/${s})`,t.style.filter="saturate(0.8)"):(t.style.filter=`hue-rotate(${Math.floor(Math.random()*360)}deg) saturate(0.8)`,t.style.backgroundImage=e.makecode?"url(./images/cart-makecode.png)":"url(./images/cart.png)",t.innerHTML=e.name,e.makecode?t.classList.add("makecode"):t.classList.add("cartridge"))}}class g{constructor(e){n(this,"selection",0);n(this,"container");this.container=document.querySelector("page-menu");let t=Math.ceil(e/12);for(let s=0;s<t;s++){const i=document.createElement("div");i.innerHTML=(s+1).toString(),this.container.append(i)}this.showPageNumber(),document.addEventListener("gamePageSelected",s=>{this.selection=s.detail,this.showPageNumber()})}selectPosition(e){this.selection+=e,this.selection<0&&(this.selection=this.container.children.length-1),this.selection>=this.container.children.length&&(this.selection=0),document.dispatchEvent(new CustomEvent("pagingSelected",{detail:this.selection}))}updateCursor(){this.container.children[this.selection].classList.add("cursor")}clearCursor(){this.container.children[this.selection].classList.remove("cursor")}showPageNumber(){for(let e of this.container.children)e.classList.remove("selected");this.container.children[this.selection].classList.add("selected")}buttonPressed(){}}class m{constructor(e){n(this,"DEBUG",!0);n(this,"numberOfBUttons",0);n(this,"axes",[]);n(this,"previousGamepad");n(this,"isConnected",!1);this.numberOfBUttons=e,this.axes.push(0,0),window.addEventListener("gamepadconnected",t=>this.onGamePadConnected(t)),window.addEventListener("gamepaddisconnected",()=>this.onGamePadDisConnected()),this.update()}get Left(){return this.axes[0]==-1}get Right(){return this.axes[0]==1}get Up(){return this.axes[1]==-1}get Down(){return this.axes[1]==1}onGamePadConnected(e){this.DEBUG&&console.log("Game pad connected"),this.previousGamepad=e.gamepad,this.isConnected=!0}onGamePadDisConnected(){this.DEBUG&&console.log("Game pad disconnected"),this.isConnected=!1}update(){if(this.isConnected){let e=navigator.getGamepads();if(!e)return;let t=e[0];if(t){for(let s=0;s<this.numberOfBUttons;s++)this.buttonPressed(t.buttons[s])&&!this.buttonPressed(this.previousGamepad.buttons[s])&&document.dispatchEvent(new Event("button"+s)),Math.abs(t.axes[0])>.9&&Math.abs(this.previousGamepad.axes[0])<.9&&(this.previousGamepad=t,document.dispatchEvent(new CustomEvent("cursorX",{detail:Math.round(t.axes[0])}))),Math.abs(t.axes[1])>.9&&Math.abs(this.previousGamepad.axes[1])<.9&&(this.previousGamepad=t,document.dispatchEvent(new CustomEvent("cursorY",{detail:Math.round(t.axes[1])})));this.axes=[Math.round(t.axes[0]),Math.round(t.axes[1])],this.previousGamepad=t}}}buttonPressed(e){return typeof e=="object"?e.pressed:e==1}}function p(a,e,t){return Math.min(Math.max(a,e),t)}class f{constructor(){n(this,"selection",0);n(this,"container");const e=["SOUND: ON","Credits","Instructions","About CMGT"];this.container=document.querySelector("credits-menu");for(let t of e){const s=document.createElement("div");s.innerHTML=t,this.container.append(s)}}selectPosition(e){this.selection=p(this.selection+e,0,this.container.children.length-1)}updateCursor(){this.container.children[this.selection].classList.add("cursor")}clearCursor(){this.container.children[this.selection].classList.remove("cursor")}buttonPressed(){this.selection==0&&r.instance.toggleSound()}updateSound(e){this.container.children[0].innerHTML=e?"SOUND:ON":"SOUND:OFF"}}const c=class c{constructor(){n(this,"selectedRow",0);n(this,"joystick");n(this,"allowSound",!0);n(this,"audio");n(this,"container");n(this,"gameMenu");n(this,"paging");n(this,"creditsMenu");c.instance=this,this.loadGames()}loadGames(){fetch("./data/games.json").then(e=>e.json()).then(e=>this.initApp(e)).catch(e=>console.log(e))}initApp(e){this.joystick=new m(2),this.createNavigation(e),this.container=document.querySelector("foreground"),this.container.addEventListener("animationend",()=>{this.container.classList.remove("monitorEffect")}),document.addEventListener("cursorX",t=>this.joyStickX(t)),document.addEventListener("cursorY",t=>this.joyStickY(t)),document.addEventListener("button0",()=>this.getSelectedMenu().buttonPressed()),document.addEventListener("keydown",t=>this.onKeyDown(t)),this.allowSound=localStorage.getItem("sound")=="true",this.audio=new Audio,this.updateAudio(),this.update(),setInterval(()=>{this.container.classList.add("monitorEffect")},4e4),this.container.classList.add("monitorEffect")}createNavigation(e){this.selectedRow=0,this.gameMenu=new u(e),this.paging=new g(e.length),this.creditsMenu=new f}selectRow(e){this.selectedRow=Math.min(Math.max(this.selectedRow+e,0),4)}getSelectedMenu(){switch(this.selectedRow){case 0:case 1:case 2:return this.gameMenu;case 3:return this.paging;case 4:return this.creditsMenu;default:return console.error("unknown row"),this.gameMenu}}joyStickX(e){this.getSelectedMenu().clearCursor();let t=e.detail;this.getSelectedMenu().selectPosition(t),this.getSelectedMenu().updateCursor()}joyStickY(e){this.getSelectedMenu().clearCursor();let t=e.detail;this.selectRow(t),this.getSelectedMenu().updateCursor()}onKeyDown(e){this.getSelectedMenu().clearCursor(),(e.key==="ArrowRight"||e.key.toLowerCase()==="d")&&this.getSelectedMenu().selectPosition(1),(e.key==="ArrowLeft"||e.key.toLowerCase()==="a")&&this.getSelectedMenu().selectPosition(-1),(e.key==="ArrowDown"||e.key.toLowerCase()==="s")&&this.selectRow(1),(e.key==="ArrowUp"||e.key.toLowerCase()==="w")&&this.selectRow(-1),(e.key==="Enter"||e.key.toLowerCase()==="e"||e.key.toLowerCase()===" ")&&this.getSelectedMenu().buttonPressed(),this.getSelectedMenu().updateCursor()}toggleSound(){this.allowSound=!this.allowSound,localStorage.setItem("sound",String(this.allowSound)),this.updateAudio()}updateAudio(){if(this.allowSound){this.audio.src="./sound/bgmusic.mp3";let e=this.audio.play();e!==void 0&&e.then(t=>{}).catch(t=>{console.error("AUDIO FOUT "+t),this.toggleSound()})}else this.audio.pause();this.creditsMenu.updateSound(this.allowSound)}update(){this.joystick.update(),requestAnimationFrame(()=>this.update())}};n(c,"instance");let r=c;new r;
